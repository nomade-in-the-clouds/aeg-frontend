<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Vehicle</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@500&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../assets/css/style.css" />
  <style>
    body {
      font-family: "Oswald", sans-serif;
      background: linear-gradient(135deg, #001f3f, #004aad);
      color: #ffffff;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    .slide-container {
      width: 100%;
      max-width: 650px;
      background: linear-gradient(145deg, #101820, #1c2b3a);
      padding: 2.5rem;
      border-radius: 15px;
      text-align: center;
      box-shadow: 0 10px 30px rgba(0, 255, 255, 0.5);
      border: 3px solid #00bcd4;
      position: relative;
      overflow: hidden;
    }
    .slide {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    .active-slide {
      display: flex;
    }
    .question-box {
      background: linear-gradient(145deg, #d0d0d0, #9c9c9c);
      padding: 12px;
      border-radius: 8px;
      text-align: center;
      width: 85%;
      max-width: 400px;
      box-shadow: inset 3px 3px 6px #666, inset -3px -3px 6px #fff;
      margin-bottom: 20px;
    }
    h2 {
      margin: 0;
      font-size: 2.5rem;
      color: #000;
      text-transform: uppercase;
    }
    input,
    select {
      width: 100%;
      padding: 14px;
      font-size: 1.4rem;
      border-radius: 8px;
      border: none;
      background: #ffffff;
      box-shadow: 4px 4px 12px rgba(0, 0, 0, 0.7),
        -4px -4px 12px rgba(255, 255, 255, 0.2);
      text-align: center;
      transition: all 0.3s ease-in-out;
    }
    input:focus,
    select:focus {
      box-shadow: 0px 0px 15px rgba(0, 255, 255, 0.8);
      outline: none;
      transform: scale(1.02);
    }
    .button-group {
      display: flex;
      justify-content: space-between;
      width: 100%;
      margin-top: 1.5rem;
    }
    .btn {
      padding: 14px 22px;
      font-size: 1.4rem;
      font-weight: bold;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      width: 48%;
      text-transform: uppercase;
      transition: all 0.3s ease-in-out;
      letter-spacing: 1px;
    }
    .next-btn {
      background: linear-gradient(145deg, #00bcd4, #0086a8);
      color: white;
      box-shadow: 0px 6px 12px rgba(0, 255, 255, 0.5);
    }
    .next-btn:hover {
      background: linear-gradient(145deg, #00e6ff, #009fcc);
      box-shadow: 0px 10px 18px rgba(0, 255, 255, 0.9);
      transform: scale(1.05);
    }
    .back-btn {
      background: linear-gradient(145deg, #707070, #4a4a4a);
      color: white;
      box-shadow: 0px 4px 12px rgba(255, 255, 255, 0.3);
    }
    .back-btn:hover {
      background: linear-gradient(145deg, #909090, #5a5a5a);
      box-shadow: 0px 6px 15px rgba(255, 255, 255, 0.6);
      transform: scale(1.05);
    }
  </style>
</head>
<body>
  <div class="slide-container">
    <form id="vehicle-form">
      <!-- Slide 0: Select Customer -->
      <div class="slide active-slide" data-slide="0">
        <div class="question-box">
          <h2>Select Customer</h2>
        </div>
        <select id="customer" name="customer" required>
          <option value="" disabled selected>Select a Customer</option>
          <!-- Dynamically load existing customers if needed -->
        </select>
        <div class="button-group">
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 1: Vehicle Type -->
      <div class="slide" data-slide="1">
        <div class="question-box">
          <h2>Vehicle Type</h2>
        </div>
        <select id="vehicle-type" name="vehicle-type" required>
          <option value="" disabled selected>Select a Vehicle Type</option>
          <option value="Car">Car</option>
          <option value="Truck">Truck</option>
          <option value="SUV">SUV</option>
          <option value="Commercial">Commercial</option>
          <option value="Motorcycle">Motorcycle</option>
          <option value="ATV">ATV</option>
        </select>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 2: Make -->
      <div class="slide" data-slide="2">
        <div class="question-box">
          <h2>Make</h2>
        </div>
        <input type="text" id="make" name="make" required />
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 3: Model -->
      <div class="slide" data-slide="3">
        <div class="question-box">
          <h2>Model</h2>
        </div>
        <input type="text" id="model" name="model" required />
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 4: Year -->
      <div class="slide" data-slide="4">
        <div class="question-box">
          <h2>Year</h2>
        </div>
        <input type="number" id="year" name="year" required />
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 5: Color -->
      <div class="slide" data-slide="5">
        <div class="question-box">
          <h2>Color</h2>
        </div>
        <input type="text" id="color" name="color" required />
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 6: SUV only -->
      <div class="slide" data-slide="6">
        <div class="question-box">
          <h2>SUV Seating</h2>
        </div>
        <select id="suvSeating" name="suv-seating">
          <option value="2-row">2-row</option>
          <option value="3-row">3-row</option>
        </select>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 7: Truck Cab -->
      <div class="slide" data-slide="7">
        <div class="question-box">
          <h2>Truck Cab</h2>
        </div>
        <select id="truckCab" name="truck-cab">
          <option value="Regular Cab">Regular Cab</option>
          <option value="Extended Cab">Extended Cab</option>
        </select>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 8: Truck Bed Size -->
      <div class="slide" data-slide="8">
        <div class="question-box">
          <h2>Truck Bed Size</h2>
        </div>
        <select id="truckBed" name="truck-bed">
          <option value="6ft">6ft Bed</option>
          <option value="8ft">8ft Bed</option>
        </select>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 9: Commercial Type -->
      <div class="slide" data-slide="9">
        <div class="question-box">
          <h2>Commercial Type</h2>
        </div>
        <select id="commercialType" name="commercial-type">
          <option value="Dump Truck">Dump Truck</option>
          <option value="Tractor Trailer">Tractor Trailer</option>
          <option value="Stakebody">Stakebody</option>
          <option value="Flatbed">Flatbed</option>
        </select>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="goNext()">Next</button>
        </div>
      </div>

      <!-- Slide 10: Final Submit -->
      <div class="slide" data-slide="10">
        <div class="question-box">
          <h2>Ready to Submit</h2>
        </div>
        <p>Click "Submit" to save your vehicle!</p>
        <div class="button-group">
          <button type="button" class="btn back-btn" onclick="goBack()">Back</button>
          <button type="button" class="btn next-btn" onclick="submitVehicle()">Submit</button>
        </div>
      </div>
    </form>
  </div>
  <script>
    // Gather all slides
    const slides = document.querySelectorAll(".slide");
    let currentFlowIndex = 0;
    let slideOrder = [0, 1, 2, 3, 4, 5, 10]; // Default order if Car/Motorcycle/ATV is chosen

    // Load customers into the dropdown
    function loadCustomers() {
      const customerSelect = document.getElementById("customer");
      customerSelect.innerHTML = '<option value="" disabled selected>Select a Customer</option>';
      let customers = JSON.parse(localStorage.getItem("customers")) || [];
      customers.forEach(customer => {
        let option = document.createElement("option");
        option.value = customer.id;
        option.textContent = customer.name;
        customerSelect.appendChild(option);
      });
    }

    // Show the specified slide
    function showSlide(slideIndex) {
      slides.forEach((slide) => slide.classList.remove("active-slide"));
      slides[slideIndex].classList.add("active-slide");
      // Focus the first input/select in this slide
      const focusable = slides[slideIndex].querySelector("input, select");
      if (focusable) focusable.focus();
      currentFlowIndex = slideOrder.indexOf(slideIndex);
    }

    // Build dynamic slide order based on vehicle type (after slide 1)
    function buildSlideOrder(vehicleType) {
      switch (vehicleType) {
        case "SUV":
          return [0, 1, 2, 3, 4, 5, 6, 10];
        case "Truck":
          return [0, 1, 2, 3, 4, 5, 7, 8, 10];
        case "Commercial":
          return [0, 1, 2, 3, 4, 5, 9, 10];
        default:
          return [0, 1, 2, 3, 4, 5, 10];
      }
    }

    // Move to the next slide
    function goNext() {
      const currentSlideIndex = slideOrder[currentFlowIndex];
      // If on slide 0, ensure a customer is selected
      if (currentSlideIndex === 0) {
        const customerSelect = document.getElementById("customer");
        if (!customerSelect.value) {
          alert("Please select a customer before proceeding.");
          return;
        }
      }
      // If on slide 1, adjust slide order based on vehicle type
      if (currentSlideIndex === 1) {
        const vType = document.getElementById("vehicle-type").value;
        if (vType) {
          slideOrder = buildSlideOrder(vType);
          currentFlowIndex = slideOrder.indexOf(1);
        }
      }
      if (currentFlowIndex < slideOrder.length - 1) {
        currentFlowIndex++;
        showSlide(slideOrder[currentFlowIndex]);
      }
    }

    // Move to the previous slide
    function goBack() {
      if (currentFlowIndex > 0) {
        currentFlowIndex--;
        showSlide(slideOrder[currentFlowIndex]);
      }
    }

    // Enable Enter key to move to next slide
    document.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        goNext();
      }
    });

    // Initialize on DOM content loaded
    document.addEventListener("DOMContentLoaded", function () {
      loadCustomers();
      showSlide(slideOrder[0]);
    });
    
    function submitVehicle() {
      const customerId = document.getElementById("customer").value;
      const vehicleType = document.getElementById("vehicle-type").value;
      const make = document.getElementById("make").value.trim();
      const model = document.getElementById("model").value.trim();
      const year = document.getElementById("year").value.trim();
      const color = document.getElementById("color").value.trim();

      if (!customerId || !make || !model || !year || !color) {
          alert("Please fill in all required fields!");
          return;
      }

      const newVehicle = {
          id: Date.now(),
          customerId: customerId,
          type: vehicleType,
          make: make,
          model: model,
          year: year,
          color: color
      };

      let vehicles = JSON.parse(localStorage.getItem("vehicles")) || [];
      vehicles.push(newVehicle);
      localStorage.setItem("vehicles", JSON.stringify(vehicles));

      fetch("http://localhost:5000/save_vehicle", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(newVehicle)
      }).catch(error => console.error("Error saving vehicle:", error));

      alert("Vehicle added successfully!");
      window.location.href = "/";
    }
  </script>
</body>
</html>
